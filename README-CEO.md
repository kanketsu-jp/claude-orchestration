# CEO操作マニュアル - Claude Orchestration

このマニュアルは、CEO（最高権限者）であるあなたがClaude Orchestrationシステムを使用してプロジェクトを管理するための完全ガイドです。

## 🎯 システム概要

### 組織構造
```
CEO (あなた) - 最高権限者、全体の指揮
└── PM (Claude) - プロジェクトマネージャー、実務の統括
    ├── Worker1 - 特定タスクの実行者
    ├── Worker2 - 特定タスクの実行者
    └── Worker3 - 特定タスクの実行者
```

### 基本的な流れ
1. **CEO（あなた）** が起動スクリプトを実行
2. **PM（Claude）** が自動的に起動
3. **CEO** がPMに指示を出す
4. **PM** が必要に応じて部下（Worker）を生成・管理
5. タスク完了後、**CEO** がセッションを終了

## 🚀 起動方法

### 1. システムの起動
```bash
# プロジェクトのルートディレクトリで実行
.claude-orchestration/scripts/start-ceo.sh
```

起動後、以下のような情報が表示されます：
```
✅ CEO Model 起動完了！

📋 使い方:

1. CEOにアタッチ:
   tmux attach -t ceo-YOUR_PROJECT-1234567890
```

### 2. セッションへの接続
表示されたコマンドをコピーして実行：
```bash
tmux attach -t ceo-YOUR_PROJECT-1234567890
```

### 3. 画面構成の確認
接続すると、3つのペインが表示されます：
```
┌─────────────────────────┬─────────────────────────┐
│                         │                         │
│  === CEO (最高権限者) ===│  === Git監視 ===       │
│                         │                         │
│  PM（Claude）が         │  Worktreeとブランチの   │
│  ここで待機しています    │  状態を監視             │
│                         │                         │
├─────────────────────────┼─────────────────────────┤
│                         │                         │
│  （PMのClaude画面）      │  === 通知監視 ===       │
│                         │                         │
│                         │  部下からの完了通知     │
│                         │                         │
└─────────────────────────┴─────────────────────────┘
```

## 📝 PMへの指示方法

### 基本的な指示
左上のPMペインで、自然言語で指示を出します：

```
# 例1: 新機能の実装
「Issue #34のノート機能を実装してください。フロントエンドとバックエンドの両方が必要です」

# 例2: バグ修正
「Issue #45のログインエラーを調査して修正してください」

# 例3: リファクタリング
「src/componentsディレクトリのコードをTypeScriptに移行してください」
```

### 効果的な指示のコツ

#### ✅ 良い指示の例
- 「Issue #34を実装してください。UIとAPIの両方が必要です」
- 「現在のビルドエラーを修正してください」
- 「テストカバレッジを80%以上に改善してください」

#### ❌ 避けるべき指示
- 「何か改善してください」（曖昧すぎる）
- 「全部作り直してください」（範囲が広すぎる）
- 「できるだけ早く」（具体性がない）

### PMの自律的な動作
PMは以下を自動的に行います：
- 必要に応じて部下（Worker）を生成
- タスクを適切に分割・割り振り
- 進捗の監視と調整
- 完了時の報告

## 🔧 作業中の操作

### 進捗の確認
- **Git監視ペイン**（右上）: 作成されたブランチやWorktreeを確認
- **通知監視ペイン**（右下）: 部下からの完了通知を確認

### PMとの対話
必要に応じて追加の指示や質問ができます：
```
「進捗はどうですか？」
「Issue #34の実装方針を説明してください」
「テストも含めて実装してください」
```

### tmuxの基本操作
- **ペイン間の移動**: `Ctrl-b` → 矢印キー
- **ペインのスクロール**: `Ctrl-b` → `[` → 矢印キーでスクロール → `q`で終了
- **セッションから一時的に離脱**: `Ctrl-b` → `d`
- **セッションに再接続**: `tmux attach -t セッション名`

## 🏁 セッションの終了

### 1. 作業の完了確認
PMに状況を確認：
```
「すべての作業は完了しましたか？コミットとプッシュも含めて確認してください」
```

### 2. クリーンアップの指示
PMに後片付けを指示：
```
「セッションを終了します。クリーンアップを実行してください」
```

PMは以下を自動的に実行：
- 未コミットの変更を確認
- 不要なWorktreeを削除
- 一時ファイルを削除

### 3. セッションの終了
```bash
# セッションから離脱
Ctrl-b → d

# セッションを完全に終了
tmux kill-session -t ceo-YOUR_PROJECT-1234567890
```

### 4. 手動クリーンアップ（必要な場合）
```bash
# 残っているセッションの確認
tmux list-sessions

# すべてのセッションを終了（注意：他の作業も終了します）
tmux kill-server

# 残っているWorktreeの確認と削除
git worktree list
git worktree remove ../YOUR_PROJECT-agent-frontend --force
```

## 💡 ベストプラクティス

### 1. Issue駆動開発
- すべての作業をGitHub Issueに紐付ける
- Issue番号を指示に含める
- 完了条件を明確にする

### 2. 段階的な指示
大きなタスクは段階的に：
1. 「まず現状を調査してください」
2. 「調査結果を基に実装計画を立ててください」
3. 「計画に従って実装を進めてください」

### 3. 定期的な確認
- 長時間の作業では定期的に進捗を確認
- ブロッカーがないか確認
- 必要に応じて方針を調整

## 👀 部下の監視

### リアルタイム監視
部下（Agent）の作業状況をリアルタイムで監視できます：

#### 方法1: PM経由で監視コマンドを取得
PMに「部下の様子を見たい」または「/agents」と伝えると、監視コマンドを教えてくれます。

#### 方法2: 新しいターミナルで監視スクリプトを実行
```bash
# プロジェクトディレクトリで実行
cd /path/to/your/project

# 高機能ダッシュボード
./agent-dashboard.sh ceo-YOUR_PROJECT-xxxxx

# シンプルな監視
./watch-agents.sh ceo-YOUR_PROJECT-xxxxx
```

### agent-dashboard.sh の使い方
起動すると3つのモードを選択できます：
1. **リアルタイム監視**: 3秒ごとに全部下の状況を自動更新
2. **スナップショット**: 現在の状況を1回だけ表示
3. **詳細表示**: 特定の部下の詳細な出力を確認

### 監視画面の見方
- **Pane情報**: 各部下のターミナルサイズとプロセス情報
- **担当タスク**: 自動的にIssue番号を抽出して表示
- **最新の活動**: 各部下の最新の出力内容

### CEOセッション内での確認
PM（Claude）に以下のように指示することもできます：
- 「check_all_agents を実行して」
- 「show_agent_detail frontend を実行して」
- 「watch_agents を実行して」

## 📨 部下からの通知システム

### 部下からPMへの直接通知
部下（Agent）がタスクを完了したときに、PMに直接通知を送ることができます。

#### 通知の送信方法（部下が実行）
```bash
# プロジェクトルートから
.claude-orchestration/scripts/notify-pm.sh "PR #47を作成しました" "Agent-Backend"
```

#### 通知の受信
- PMのClaude Codeに直接表示されます
- 通知履歴: `/tmp/プロジェクト名-pm-notifications.txt`

#### PR自動監視
新しいPRの作成を自動検出してPMに通知：
```bash
# 30秒ごとに監視（バックグラウンド実行）
.claude-orchestration/scripts/check-pr-status.sh 30 &
```

### 部下への指示例
```
部下に作業完了時は必ず以下を実行するよう指示してください：
.claude-orchestration/scripts/notify-pm.sh "メッセージ" "Agent名"
```

## ⚠️ トラブルシューティング

### PMが応答しない
```bash
# PMペインで
Ctrl-c
# その後、再度指示を出す
```

### セッションが見つからない
```bash
# 実行中のセッションを確認
tmux list-sessions

# セッション名を確認
cat /tmp/*-session-name.txt
```

### Worktreeが残っている
```bash
# 確認
git worktree list

# 削除
git worktree remove パス --force
```

## 🔒 セキュリティとコスト管理

### モデル使用の確認
PMが適切なモデルを使用しているか確認：
```
「現在使用しているモデルを教えてください」
「コスト使用状況を確認してください（bunx ccusage）」
```

### 推奨されるモデル使用
- **PM**: 通常はDefault、複雑な問題のみOpus
- **Worker**: 必ずSonnet（コスト効率）

## 📋 チェックリスト

### セッション開始時
- [ ] プロジェクトのルートディレクトリにいることを確認
- [ ] 既存のtmuxセッションがないことを確認
- [ ] GitHub Issueが作成されていることを確認

### セッション終了時
- [ ] すべての変更がコミット・プッシュされたことを確認
- [ ] PMにクリーンアップを指示
- [ ] セッションを正しく終了
- [ ] 残留ファイルがないことを確認

## 🚨 緊急時の対応

### すべてを強制終了
```bash
# すべてのtmuxセッションを終了
tmux kill-server

# すべてのWorktreeを削除
git worktree list | grep -v main | awk '{print $1}' | xargs -I {} git worktree remove {} --force

# プロセスの確認
ps aux | grep -E "(cca|claude)"
```

---

このマニュアルは随時更新されます。問題や改善提案がある場合は、GitHub Issueで報告してください。